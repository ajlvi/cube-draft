<html><head><title>Cube draft</title>
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Ubuntu:regular,bold&subset=Latin">

<link rel="stylesheet" href="{{ url_for('static', filename='css/cubedraft.css') }}">

<script charset="UTF-8" type="text/JavaScript" src="{{ url_for('static', filename='card-choosing.js') }}"></script>
<script charset="UTF-8" type="text/JavaScript" src="{{ url_for('static', filename='interface-setup.js') }}"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>

//let's make some functions we'll be reusing a lot
//this one pings the server to ask for the current state, without sending data

var datadump = null;

function ping() {
	$.get('/makepick', function(response) {
		dataDump = response;
		updatePicks(response); //update the list of existing picks
		if (response['my_status']==0) {
			setTimeout(function() {ping(); }, 2000);
			}
		else {
			//this means we have to populate the table!
			populateTable(response['current_pack'],response['current_df']);
			setTimer(response['time_remaining']);
			} 
		});
	};

function updatePicks() {
	//for each card in the cardlist, we'll determine the pack and pick number, then get a string of html, then insert it
	var cardlist = dataDump['chosen_cards']
	var packs = dataDump['total_packs']
	var picks = dataDump['cards_per_pack']
	var thispack = 1;
	var thispick = 1;
	for (j=0; j<cardlist.length; j++) {
		makeJSPick(cardlist[j], thispack, thispick);
		if (thispick < picks) {thispick++;}
		else {thispick = 1; thispack++;}
	}
};


function setTimer(time) {
	i = Math.floor(time);
	setInterval(function() {runTimer(i);}, 1000);
	};
function runTimer(num) {
	if (num > 0) {
		min = Math.floor(num/60);
		sec = num - min*60;
		if (sec < 10) {secstring = '0'+ sec.toString();}
		else {secstring = sec.toString();}
		$("#timer").text(min.toString() + ':' + secstring);
		i--;
		}
	else if (num==0) {
		//makePick(cardname, pack, pick);
		$("#timer").text('time is up!');
		}
	};

function populateTable(cardlist,cardinfo) {
	//this should take a response that contains a new pack and populate the table with it
	//we need to make a cell for each card
	cardinfo = JSON.parse(cardinfo);
	for (j=0; j<cardlist.length; j++) {
		cardid = cardlist[j].toString();
		name = cardinfo['card'][cardlist[j]];
		imgsrc = cardinfo['scryfall'][cardlist[j]];
		$("#packdisp").append('<td><img src="' + imgsrc + '" class="card-image unreserved" name="' + name + '" id="' + cardid + '"></td>');
	}
	initializePack();
};

function initializePack() {
	$(".unreserved").click(function(){
		$(".card-image").not(this).removeClass("reserved");
		$(".card-image").not(this).addClass("unreserved");
		$(".card-image").not(this).off("dblclick");
		$(this).removeClass("unreserved");
		$(this).addClass("reserved");
		$(this).off("dblclick");
		$(this).dblclick(function(){
			var cardname = $(this).attr("name");
			var cardid = $(this).attr("id");
			makePick(cardid, player);
			//if (pick < 15) {pick++;}
			//else {pick = 1; pack++;}
			$(this).addClass("unreserved");
			$(this).removeClass("reserved");
		}); 
	}) ;
};
	

$(document).ready(function(){
	ping();
});
	
$(document).ready(function(){
	$(".unreserved:first").addClass("reserved");
	$(".unreserved:first").removeClass("unreserved");
});

</script>
</head>

<body>
<div class="content">
<div class="draft-interface">
<div id="pack-table">
<table><tr id="packdisp">
<!-- eight picks in first row -->
</tr><tr>

<td class="buttonbox"> <button id="confirm">confirm pick</button></td></tr></table>
</div>

<div id="under-pack-info">

<!-- just sticking the timer here, you can move it/style it -->
<div id="timer"></div>

</div>
</div>

	<div id="vertbar" class="vertical-holder">
<!-- This is populated by the vertBar function in interface-setup.js. -->
	</div>

</div>
<div class="bottom-holder">
<div class="cmc-stack">
	<span class="cost cmcbox" id="cmc-1">0-1</span><br>
	<span class="critter cmcbox" id="creatures-1">test<br>test</span><br>
	<span class="spell cmcbox" id="noncreatures-1">test</span>
</div>
<div class="cmc-stack">
	<span class="cost cmcbox" id="cmc-2">2</span><br>
	<span class="critter cmcbox" id="creatures-2"></span><br>
	<span class="spell cmcbox" id="noncreatures-2"></span>
</div>
<div class="cmc-stack">
	<span class="cost cmcbox" id="cmc-3">3</span><br>
	<span class="critter cmcbox" id="creatures-3"></span><br>
	<span class="spell cmcbox" id="noncreatures-3"></span>
</div>
<div class="cmc-stack">
	<span class="cost cmcbox" id="cmc-4">4</span><br>
	<span class="critter cmcbox" id="creatures-4"></span><br>
	<span class="spell cmcbox" id="noncreatures-4"></span>
</div>
<div class="cmc-stack">
	<span class="cost cmcbox" id="cmc-5">5</span><br>
	<span class="critter cmcbox" id="creatures-5"></span><br>
	<span class="spell cmcbox" id="noncreatures-5"></span>
</div>
<div class="cmc-stack">
	<span class="cost cmcbox" id="cmc-6">6+</span><br>
	<span class="critter cmcbox" id="creatures-6"></span><br>
	<span class="spell cmcbox" id="noncreatures-6"></span>
</div>

<script>vertBar(3, 15)</script>
</body></html>