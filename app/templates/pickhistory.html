{% extends 'base.html' %}

{% block scripts %}
<style><!--
body {background: #CCCCCC} 
.history-pick-cell { position : relative ; }
.checkbox { position : absolute; top: 20%; left:30%; font-size: 72pt; color : white  }
.pick-number-cell {min-width : 50px }
.history-card-image {width : 150px; height: 209px; }
tr.one-row-pack > td { padding: 5px 0px 5px 0px }
tr.two-row-top > td { padding: 5px 0px 0px 0px }
tr.two-row-bot > td { padding: 0px 0px 5px 0px }
.overtint { position:absolute; background-color: rgba(204, 204, 204, 0.35); width:150px; height:209px; }
--></style>

<script>
//var pickData = {'packs': {0: [67, 75, 149, 150, 278, 343, 344, 368, 450, 468], 1: [0, 61, 106, 154, 155, 296, 304, 369, 377], 2: [67, 75, 278, 343, 344, 368, 450, 468], 3: [106, 154, 155, 296, 304, 369, 377], 4: [67, 343, 344, 368, 450, 468], 5: [106, 154, 296, 369, 377], 6: [67, 368, 450, 468], 7: [106, 296, 377], 8: [67, 468], 9: [296]}, 'picks': {0: [149], 1: [61], 2: [278], 3: [304], 4: [344], 5: [154], 6: [368], 7: [106], 8: [67], 9: [296]}, 'images': {67: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/3/3/33b8553d-d326-4280-bc3a-2fffdd377cd2.jpg?1562014167', 75: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/8/0/8003a31f-7662-4e9e-8165-1ceea04fdf20.jpg?1562789282', 149: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/0/9/093426d2-29e0-49e4-b02a-a70cce3b25d5.jpg?1562782281', 150: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/c/a/ca367f49-0f4a-4b7f-8104-851893fbcd8a.jpg?1562937711', 278: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/1/2/12befd35-2dc6-4852-a153-75b553042643.jpg?1562898942', 343: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/8/8/8811d210-23e2-4318-9730-7ee3b2021c68.jpg?1562922516', 344: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/4/4/44614c6d-5508-4077-b825-66d5d684086c.jpg?1572894024', 368: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/7/4/7410c546-745c-469f-b3b8-eafb69391600.jpg?1598917562', 450: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/0/8/0824a960-dd89-45c5-90f0-3ec9eb47d9ce.jpg?1562782193', 468: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/f/d/fd097ea2-0a1c-44a0-824b-d5373df513fb.jpg?1562948625', 0: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/2/5/251015ed-9408-4941-894a-158551ed2613.jpg?1562815791', 61: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/2/0/20de275a-2e11-4452-8037-bc397dd53a8c.jpg?1562901915', 106: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/d/4/d4de14d1-441f-4d65-bd12-df0506530015.jpg?1562945663', 154: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/2/b/2ba07e86-fdef-4f51-808e-7780883eefe3.jpg?1562784407', 155: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/1/e/1e53cd8b-18f8-4950-84d4-7aafa26c7ae4.jpg?1576381850', 296: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/9/9/990f4438-aa74-4460-8bac-93480d0bb0dc.jpg?1593092828', 304: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/4/1/41d1a332-f950-4f56-9b1e-37c0954e72f6.jpg?1562829271', 369: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/9/8/9854e673-1816-4a76-b9db-bb399ac7489f.jpg?1581481079', 377: 'https://c1.scryfall.com/file/scryfall-cards/normal/front/6/1/61e3b73a-598b-4854-b811-2fd40fbce2d0.jpg?1562641629'}, 'tot_packs': 1, 'pack_size': 10, 'tossed': 0}

//grab the dictionary from flask
var pickData = '{{ data }}'
function makePickBlock(p) {
	packno = 1 + Math.floor( p / (pickData["pack_size"] - pickData["tossed"]) );
	pickno = 1 + p % (pickData["pack_size"] - pickData["tossed"]);
	if ( pickData["packs"][p].length <= 8 )
		{
		var out = '<tr class="one-row-pack">';
		out = out + '<td class="pick-number-cell">Pack ' + packno.toString() + '<br>Pick ' + pickno.toString() + '</td>'
		for (pno = 0; pno < pickData["packs"][p].length; pno++) { 
			var cardID = pickData["packs"][p][pno]
			var wasPicked = false
			if ( pickData["picks"][p].indexOf(cardID) >= 0 ) { wasPicked = true }
			if ( wasPicked ) {
			out = out + '<td class="history-pick-cell"><div class="overtint"></div><img src="' + pickData["images"][cardID] + '" class="history-card-image"><div class="checkbox">&check;</div></td>';
				}
			else {
			out = out + '<td class="history-pick-cell"><img src="' + pickData["images"][cardID] + '" class="history-card-image"></td>';
				}
			}
		var deficit = 8 - pickData["packs"][p].length
		if (deficit >= 1) { out = out + "<td colspan=" + deficit + "></td>" }
		out = out + "</tr>"; return out
		}
	else {
		var out = '<tr class="two-row-top">';
		out = out + '<td class="pick-number-cell">Pack ' + packno.toString() + '<br>Pick ' + pickno.toString() + '</td>'
		for (pno = 0; pno < 8; pno++) { 
			var cardID = pickData["packs"][p][pno]
			var wasPicked = false
			if ( pickData["picks"][p].indexOf(cardID) >= 0 ) { wasPicked = true }
			if ( wasPicked ) {
			out = out + '<td class="history-pick-cell"><div class="overtint"></div><img src="' + pickData["images"][cardID] + '" class="history-card-image"><div class="checkbox">&check;</div></td>';
				}
			else {
			out = out + '<td class="history-pick-cell"><img src="' + pickData["images"][cardID] + '" class="history-card-image"></td>';
				}
			}
		out = out + '</tr>\n<tr class="two-row-bot"><td></td>'
		for (pno = 8; pno < pickData["packs"][p].length; pno++) { 
			var cardID = pickData["packs"][p][pno]
			var wasPicked = false
			if ( pickData["picks"][p].indexOf(cardID) >= 0 ) { wasPicked = true }
			if ( wasPicked ) {
			out = out + '<td class="history-pick-cell"><div class="overtint"></div><img src="' + pickData["images"][cardID] + '" class="history-card-image"><div class="checkbox">&check;</div></td>';
				}
			else {
			out = out + '<td class="history-pick-cell"><img src="' + pickData["images"][cardID] + '" class="history-card-image"></td>';
				}
			}
		var deficit = 16 - pickData["packs"][p].length
		if (deficit >= 1) { out = out + "<td colspan=" + deficit + "></td>" }
		out = out + "</tr>"; return out
	}
}

function makeTable() {
	output = "<table id='history-table'>"
	for (i=0; i < Object.keys(pickData["picks"]).length; i++)
		{ output = output + "\n" + makePickBlock(i) }
//	$("table-loc").html(output); 
	loc = document.getElementById("table-loc")
	loc.innerHTML = output; 
}
</script>
{% endblock %}


{% block content %}
	<div class="upper-history-bar"></div>
	<div id="table-loc">
	<script>makeTable()</script>
	</div>
{% endblock %}
